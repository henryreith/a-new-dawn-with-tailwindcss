{%- style -%}
  .section-{{ section.id }}-padding {
    padding-top: {{ section.settings.padding_top | times: 0.75 | round: 0 }}px;
    padding-bottom: {{ section.settings.padding_bottom | times: 0.75 | round: 0 }}px;
  }
  @media screen and (min-width: 750px) {
    .section-{{ section.id }}-padding {
      padding-top: {{ section.settings.padding_top }}px;
      padding-bottom: {{ section.settings.padding_bottom }}px;
    }
  }
{%- endstyle -%}

{%- assign howitworks = section.settings.how_it_works -%}
{%- if howitworks -%}
  {%- comment -%} Build the heading text {%- endcomment -%}
  {%- assign section_title = section.settings.heading -%}
  {%- if section.settings.append_product_name and product.title -%}
    {%- assign section_title = section_title | append: ' ' | append: product.title -%}
  {%- endif -%}

  {%- assign content_width_class = 'page-width' -%}
  {%- case section.settings.section_content_width -%}
    {%- when 'narrow' -%}
      {%- assign content_width_class = 'page-width page-width--narrow' -%}
    {%- when 'full_width' -%}
      {%- assign content_width_class = '' -%}
  {%- endcase -%}

  <section class='section-{{ section.id }}-padding gradient color-{{ section.settings.color_scheme }}'>
    <div class='{{ content_width_class }}'>
      {%- comment -%} Title {%- endcomment -%}
      <h2 class='tw-text-3xl tw-font-bold tw-text-center tw-mb-4'>
        {{ section_title }}
      </h2>

      {%- comment -%} Sub-description {%- endcomment -%}
      {% if howitworks.description != blank %}
        <div class='tw-text-center tw-text-lg tw-mb-8'>
          {{ howitworks.description | richtext }}
        </div>
      {% endif %}

      <div class='tw-grid tw-grid-cols-1 lg:tw-grid-cols-2 tw-gap-12'>
        {%- comment -%} Media + ordering logic {%- endcomment -%}
        {% if section.settings.media_position == 'left' %}
          <div class='tw-flex tw-justify-center'>
            {% if howitworks.media.media_content_type == 'video' %}
              <video class='tw-rounded-lg tw-shadow-lg tw-w-full tw-max-w-md' controls>
                <source src='{{ howitworks.media | file_url }}' type='video/mp4'>
                Your browser does not support the video tag.
              </video>
            {% else %}
              {{ howitworks.media | image_tag: class: 'tw-rounded-lg tw-shadow-lg tw-w-full tw-max-w-md' }}
            {% endif %}
          </div>
          <div>
            {%- comment -%} Steps list {%- endcomment -%}
            <ol class='tw-space-y-8'>
              {% for step in howitworks.steps %}
                <li class='tw-flex tw-items-start'>
                  {% if step.icon != blank %}
                    {{ step.icon | image_tag: class: 'tw-h-10 tw-w-10 tw-mr-4' }}
                  {% else %}
                    <span class='tw-flex-shrink-0 tw-h-10 tw-w-10 tw-bg-blue-600 tw-text-white tw-rounded-full tw-flex tw-items-center tw-justify-center tw-font-bold tw-text-xl tw-mr-4'>
                      {{ forloop.index }}
                    </span>
                  {% endif %}
                  <div class='tw-text-lg tw-leading-relaxed' style='max-width: 32rem;'>
                    {{ step.step_text | richtext }}
                  </div>
                </li>
              {% endfor %}
            </ol>
          </div>
        {% else %}
          <div class='lg:tw-order-2 tw-flex tw-justify-center'>
            {% if howitworks.media.media_content_type == 'video' %}
              <video class='tw-rounded-lg tw-shadow-lg tw-w-full tw-max-w-md' controls>
                <source src='{{ howitworks.media | file_url }}' type='video/mp4'>
                Your browser does not support the video tag.
              </video>
            {% else %}
              {{ howitworks.media | image_tag: class: 'tw-rounded-lg tw-shadow-lg tw-w-full tw-max-w-md' }}
            {% endif %}
          </div>
          <div class='lg:tw-order-1'>
            {%- comment -%} Steps list {%- endcomment -%}
            <ol class='tw-space-y-8'>
              {% for step in howitworks.steps %}
                <li class='tw-flex tw-items-start'>
                  {% if step.icon != blank %}
                    {{ step.icon | image_tag: class: 'tw-h-10 tw-w-10 tw-mr-4' }}
                  {% else %}
                    <span class='tw-flex-shrink-0 tw-h-10 tw-w-10 tw-bg-blue-600 tw-text-white tw-rounded-full tw-flex tw-items-center tw-justify-center tw-font-bold tw-text-xl tw-mr-4'>
                      {{ forloop.index }}
                    </span>
                  {% endif %}
                  <div class='tw-text-lg tw-leading-relaxed' style='max-width: 32rem;'>
                    {{ step.step_text | richtext }}
                  </div>
                </li>
              {% endfor %}
            </ol>
          </div>
        {% endif %}
      </div>
    </div>
  </section>
{%- endif -%}

{% schema %}
{
  "name": "How It Works",
  "settings": [
    {
      "type": "text",
      "id": "heading",
      "label": "Section title",
      "default": "How it works"
    },
    {
      "type": "checkbox",
      "id": "append_product_name",
      "label": "Append product name to title",
      "default": false
    },
    {
      "type": "metaobject",
      "id": "how_it_works_object",
      "label": "How It Works content",
      "metaobject_type": "how_it_works"
    },
    {
      "type": "select",
      "id": "media_position",
      "label": "Media on desktop",
      "options": [
        { "label": "Left", "value": "left" },
        { "label": "Right", "value": "right" }
      ],
      "default": "left"
    },
    {
      "type": "select",
      "id": "section_content_width",
      "label": "Content width",
      "options": [
        { "label": "Full width", "value": "full_width" },
        { "label": "Page width", "value": "page_width" },
        { "label": "Narrow", "value": "narrow" }
      ],
      "default": "page_width"
    },
    {
      "type": "range",
      "id": "padding_top",
      "label": "Padding top",
      "min": 0,
      "max": 100,
      "step": 4,
      "unit": "px",
      "default": 40
    },
    {
      "type": "range",
      "id": "padding_bottom",
      "label": "Padding bottom",
      "min": 0,
      "max": 100,
      "step": 4,
      "unit": "px",
      "default": 40
    },
    {
      "type": "color_scheme",
      "id": "color_scheme",
      "label": "Color scheme",
      "default": "scheme-1"
    }
  ],
  "presets": [
    {
      "name": "How It Works"
    }
  ]
}
{% endschema %}
